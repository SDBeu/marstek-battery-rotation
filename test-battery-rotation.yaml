# ============================================================================
# TEST TEMPLATE - Plak in Developer Tools â†’ Template
# ============================================================================

=== BATTERIJ STATUS ===

Fase A (schuin): {{ states('sensor.marstek_venuse_d828_state_of_charge') }}%
Fase B (plat):   {{ states('sensor.marstek_venuse_3_0_9a7d_state_of_charge') }}%
Fase C (geen):   {{ states('sensor.marstek_venuse_state_of_charge') }}%

P1 Meter: {{ states('sensor.p1_meter_power') }}W
{% if states('sensor.p1_meter_power')|float < 0 %}
  â†’ â˜€ï¸ Teruglevering (zonoverschot)
{% else %}
  â†’ âš¡ Verbruik van net
{% endif %}

=== LEEGSTE/VOLSTE BATTERIJ ===

{% set batteries = [
  {'name': 'fase_a', 'label': 'Fase A (schuin)', 'soc': states('sensor.marstek_venuse_d828_state_of_charge')|float(0)},
  {'name': 'fase_b', 'label': 'Fase B (plat)', 'soc': states('sensor.marstek_venuse_3_0_9a7d_state_of_charge')|float(0)},
  {'name': 'fase_c', 'label': 'Fase C (geen)', 'soc': states('sensor.marstek_venuse_state_of_charge')|float(0)}
] %}

Leegste: {{ (batteries | sort(attribute='soc') | first).label }} ({{ (batteries | sort(attribute='soc') | first).soc }}%)
Volste:  {{ (batteries | sort(attribute='soc', reverse=true) | first).label }} ({{ (batteries | sort(attribute='soc', reverse=true) | first).soc }}%)

=== BUTTON ENTITIES CHECK ===

{% set buttons = [
  'button.fasea_schuin_d828_auto_mode',
  'button.fasea_schuin_d828_manual_mode',
  'button.faseb_plat_v3_9a7d_auto_mode',
  'button.faseb_plat_v3_9a7d_manual_mode',
  'button.fasec_geen_deb8_auto_mode',
  'button.fasec_geen_deb8_manual_mode'
] %}

{% for button in buttons %}
  {% if states(button) != 'unknown' and states(button) != 'unavailable' %}
âœ… {{ button }}
  {% else %}
âŒ {{ button }} - NIET BESCHIKBAAR!
  {% endif %}
{%- endfor %}

=== AUTOMATION TRIGGERS ===

{% if states('sensor.p1_meter_power')|float < -500 %}
ğŸŸ¢ SOLAR EXCESS trigger actief! ({{ states('sensor.p1_meter_power') }}W < -500W)
   â†’ Zou moeten switchen naar: {{ (batteries | sort(attribute='soc') | first).label }}
{% elif states('sensor.p1_meter_power')|float > 200 %}
ğŸŸ¢ GRID CONSUMPTION trigger actief! ({{ states('sensor.p1_meter_power') }}W > 200W)
   â†’ Zou moeten switchen naar: {{ (batteries | sort(attribute='soc', reverse=true) | first).label }}
{% else %}
âšª Geen triggers actief (P1 tussen -500W en +200W)
{% endif %}

=== CONFIGURATIE OK? ===

{% if buttons | select('is_state', 'unknown') | list | length == 0 %}
âœ… Alle buttons beschikbaar!
âœ… Template sensors werken!
âœ… Configuratie is klaar om te installeren!
{% else %}
âŒ Er zijn problemen met buttons (zie hierboven)
{% endif %}
